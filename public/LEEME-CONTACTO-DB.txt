Errores frecuentes Supabase + Netlify
=====================================

--- "new row violates row-level security policy for table projects" ---

Al crear o editar un proyecto en /admin:

1. Ejecutar el SQL en Supabase (solo una vez):
   - Supabase Dashboard → SQL Editor → New query
   - Copiá TODO el contenido de supabase/run-projects-rls.sql
   - Pegá y Run

2. En Netlify (Site → Environment variables) tenés que tener:
   SUPABASE_SERVICE_ROLE_KEY = el valor "service_role" (secret) de Supabase.
   - Entrá a Supabase → Project Settings → API
   - Copiá la clave "service_role" (secret), no la "anon" (public).
   - En Netlify agregá la variable SUPABASE_SERVICE_ROLE_KEY con ese valor y redeploy.

Si usás la anon key en vez de la service_role, RLS sigue activo y no podés insertar.

---

Formulario de contacto — "No se pudo guardar"
==============================================

Si ves "No se pudo guardar. Intenta más tarde." al enviar el formulario:

1. Crear la tabla en Supabase (solo una vez)
   - Entrá a: https://supabase.com/dashboard → tu proyecto → SQL Editor
   - Abrí el archivo: supabase/migrations/20250210100000_contact_messages.sql
   - Copiá TODO el contenido y ejecutalo (Run).
   - Opcional: ejecutá también 20250210100001_contact_messages_policy.sql

2. Variables de entorno en producción (Netlify / Vercel)
   El API de contacto necesita:
   - NEXT_PUBLIC_SUPABASE_URL
   - SUPABASE_SERVICE_ROLE_KEY   ← importante: tiene que estar definida (no la anon key)

   Sin SUPABASE_SERVICE_ROLE_KEY la API no puede escribir en la tabla.

3. Ver el error real
   En los logs del deploy (Netlify: Deploys → Function logs, o "No se pudo guardar" en la request)
   deberías ver algo como "[api/contact] Supabase insert error: ...". Si dice "relation contact_messages does not exist", creá la tabla con el paso 1.

---

Formulario de contacto — "Los mails no llegan"
==============================================

Si el mensaje se guarda en la DB pero no recibís el email en hola@pablogoldberg.com:

1. Configurá SMTP de Hostinger en .env y en producción (Netlify/Vercel):
   - SMTP_HOST=smtp.hostinger.com
   - SMTP_PORT=465
   - SMTP_SECURE=true
   - SMTP_USER=hola@pablogoldberg.com
   - SMTP_PASS=tu_password_smtp
   - SMTP_FROM=Contacto Web <hola@pablogoldberg.com>
   - SMTP_TO=hola@pablogoldberg.com

2. Si usás puerto 587:
   - SMTP_PORT=587
   - SMTP_SECURE=false

3. Revisá logs de deploy:
   - Si hay error, vas a ver "[api/contact] SMTP error: ..."
   - Si faltan variables, vas a ver:
     "[api/contact] SMTP not configured or failed..."

---

Videos Vimeo ocultos — tabla o RLS
====================================

"Could not find the table 'public.hidden_vimeo_ids'":
  1. SQL Editor → ejecutá supabase/run-hidden-vimeo.sql (crea la tabla y políticas).

"new row violates row-level security policy for table hidden_vimeo_ids":
  1. Ejecutá de nuevo supabase/run-hidden-vimeo.sql (ahora incluye políticas INSERT/UPDATE/DELETE para service_role).
  O ejecutá todo de una: supabase/run-all-rls-policies.sql (proyectos, pages, hidden_vimeo_ids).

Asegurate de tener SUPABASE_SERVICE_ROLE_KEY en Netlify con la clave "service_role" (secret) de Supabase.

Comportamiento: la web pública /work muestra hasta 40 videos (los primeros 40 no ocultos).
Cuando ocultás uno, el siguiente de la lista de Vimeo pasa a ocupar su lugar (pedimos 60 a la API, filtramos ocultos, mostramos 40).

---

Videos personalizados por ID (agregar a /work)
==============================================

Para que un video de Vimeo aparezca en /work aunque no esté en los 60 del portfolio:

1. Crear la tabla en Supabase (solo una vez): SQL Editor → ejecutar supabase/run-custom-vimeo.sql
2. En /admin/vimeo-hidden, desplegá "Añadir por ID" y pegá el ID del video (ej. de la URL vimeo.com/123456789).
3. Clic en "Agregar a trabajo". El video entra en la lista y en /work (al tope). Para quitarlo: en la card del video, "Quitar de trabajo".
